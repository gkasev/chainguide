<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>the Chain Guide - Find Bycicle-Specific Technical Information, Reviews, Stories and Products</title>

    <script type="module">
        import { Application, Controller } from "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js"
        window.Stimulus = Application.start()

        Stimulus.register("search", class extends Controller {
            static targets = [ "query", "results" ]
            static values = { url: String }

            getResults () {
                const params = new URLSearchParams({ q: this.queryTarget.value })
                const searchQueryUrl = this.urlValue + params

                fetch(searchQueryUrl)
                    .then(response => response.json())
                    .then(data => data.response.docs)
                    .then(docs => {
                        var resultsHTML = ""
                        docs.forEach((docJSON) => {
                            resultsHTML += '<a href="http://' + docJSON.url + '">' + docJSON.url + '</a>'
                            resultsHTML += '<h3>' + docJSON.title + '</h3>'
                        })
                        this.resultsTarget.innerHTML = resultsHTML
                    })
            }
        })
    </script>

</head>
<body>
    <h1><i>the</i>ChainGuide</h1>
    <p>Find Bycicle-Specific Technical Information, Reviews, Stories and Products</p>
    <div data-controller="search"
         data-search-url-value="/solr/techinfo/query?">
        <input type="text", data-search-target="query">
        <input type="submit", data-action="click->search#getResults", value="Search">
        <p></p>
        <div data-search-target="results"></div>
    </div>
    <p>This search index is community-curated. <a href="https://github.com/gkasev/sindie">Come join me!</a></p>
</body>
</html>